# PyScript è„šæœ¬è¯­è¨€å‡†ç¡®è§„èŒƒ

## ç›®å½•

1. [è¯­è¨€æ¦‚è¿°](#1-è¯­è¨€æ¦‚è¿°)
2. [è¯­æ³•æ€»è§ˆ](#2-è¯­æ³•æ€»è§ˆ)
3. [åŸºæœ¬è¯­æ³•å…ƒç´ ](#3-åŸºæœ¬è¯­æ³•å…ƒç´ )
4. [æ•°æ®ç±»å‹ä¸å­—é¢é‡](#4-æ•°æ®ç±»å‹ä¸å­—é¢é‡)
5. [å˜é‡ä¸èµ‹å€¼](#5-å˜é‡ä¸èµ‹å€¼)
6. [è¡¨è¾¾å¼ä¸è¿ç®—ç¬¦](#6-è¡¨è¾¾å¼ä¸è¿ç®—ç¬¦)
7. [æ§åˆ¶æµè¯­å¥](#7-æ§åˆ¶æµè¯­å¥)
8. [å‡½æ•°å®šä¹‰ä¸è°ƒç”¨](#8-å‡½æ•°å®šä¹‰ä¸è°ƒç”¨)
9. [Pythoné›†æˆç‰¹æ€§](#9-pythoné›†æˆç‰¹æ€§)
10. [æ¨¡å—ä¸å¯¼å…¥](#10-æ¨¡å—ä¸å¯¼å…¥)
11. [å®é™…ä»£ç ç¤ºä¾‹](#11-å®é™…ä»£ç ç¤ºä¾‹)
12. [è¯­è¨€é™åˆ¶ä¸ä¸æ”¯æŒçš„ç‰¹æ€§](#12-è¯­è¨€é™åˆ¶ä¸ä¸æ”¯æŒçš„ç‰¹æ€§)
13. [APIå‚è€ƒ](#13-apiå‚è€ƒ)

---

## 1. è¯­è¨€æ¦‚è¿°

PyScriptæ˜¯ä¸€ä¸ªä¸ºC++/Pythonæ··åˆç¼–ç¨‹è®¾è®¡çš„è„šæœ¬è¯­è¨€ï¼Œé€šè¿‡ANTLR4å®šä¹‰è¯­æ³•ï¼Œé€šè¿‡pybind11æ¡¥æ¥Pythonã€‚å®ƒä¸æ˜¯å®Œæ•´çš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯æä¾›åŸºç¡€è„šæœ¬åŠŸèƒ½ä¸Pythonäº¤äº’ã€‚

### 1.1 æ ¸å¿ƒå®šä½
- **è½»é‡çº§è„šæœ¬è¯­è¨€**ï¼šåŸºç¡€è¯­æ³•ï¼Œæœ‰é™åŠŸèƒ½é›†
- **Pythonæ¡¥æ¥å™¨**ï¼šä¸»è¦ç›®çš„æ˜¯è°ƒç”¨Pythonä»£ç 
- **é…ç½®ä¸è‡ªåŠ¨åŒ–**ï¼šé€‚åˆç®€å•è„šæœ¬å’Œé…ç½®åœºæ™¯
- **éé€šç”¨è¯­è¨€**ï¼šä¸æ”¯æŒå¤æ‚ç¼–ç¨‹èŒƒå¼

### 1.2 è¯­æ³•è®¾è®¡åŸåˆ™
- ç±»ä¼¼Pythonä½†éå®Œå…¨å…¼å®¹
- ä½¿ç”¨Cé£æ ¼çš„å¤§æ‹¬å·å’Œåˆ†å·
- é™æ€ä½œç”¨åŸŸï¼ŒåŠ¨æ€ç±»å‹
- æœ€å°åŒ–çš„è¯­æ³•é›†åˆ

## 2. è¯­æ³•æ€»è§ˆ

### 2.1 æ”¯æŒçš„è¯­å¥ç±»å‹
```python
// å¯¼å…¥è¯­å¥
import os;

// å‡½æ•°å®šä¹‰
def add(x, y) {
    return x + y;
}

// å˜é‡èµ‹å€¼
x = 10;

// æ§åˆ¶æµ
if (x > 0) {
    print("positive");
}

// å¾ªç¯
for (i = 0; i < 10; i = i + 1) {
    print(i);
}

// è¡¨è¾¾å¼è¯­å¥
print("hello");
```

### 2.2 ç¨‹åºç»“æ„
```
ç¨‹åº â†’ è¯­å¥åºåˆ—
è¯­å¥ â†’ å¯¼å…¥ | å‡½æ•°å®šä¹‰ | èµ‹å€¼ | æ§åˆ¶æµ | è¿”å› | è¡¨è¾¾å¼
```

## 3. åŸºæœ¬è¯­æ³•å…ƒç´ 

### 3.1 æ³¨é‡Š
```python
// å•è¡Œæ³¨é‡Š
# ä¹Ÿæ˜¯å•è¡Œæ³¨é‡Šï¼ˆPythoné£æ ¼ï¼‰

/*
 * å¤šè¡Œæ³¨é‡Š
 * æ”¯æŒå¤šè¡Œ
 */
```

### 3.2 è¯­å¥åˆ†éš”
- åˆ†å·`;`å¯é€‰ï¼Œä½†å»ºè®®ä½¿ç”¨
- å¤§æ‹¬å·`{}`ç”¨äºä»£ç å—
- ç©ºæ ¼å’Œæ¢è¡Œç¬¦é€šå¸¸è¢«å¿½ç•¥

### 3.3 æ ‡è¯†ç¬¦å‘½å
- å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´
- å¯åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- åŒºåˆ†å¤§å°å†™

## 4. æ•°æ®ç±»å‹ä¸å­—é¢é‡

### 4.1 åŸºæœ¬æ•°æ®ç±»å‹
| ç±»å‹ | å­—é¢é‡ç¤ºä¾‹ | è¯´æ˜ |
|------|-----------|------|
| æ•´æ•° | `42`, `-10`, `0` | æ•´æ•°å­—é¢é‡ |
| æµ®ç‚¹æ•° | `3.14`, `-2.5`, `.5` | æµ®ç‚¹æ•°å­—é¢é‡ |
| å­—ç¬¦ä¸² | `"hello"`, `'world'` | å­—ç¬¦ä¸²å­—é¢é‡ |
| å¸ƒå°”å€¼ | `true`, `false` | å¸ƒå°”å­—é¢é‡ |
| ç©ºå€¼ | `null` | ç©ºå€¼å­—é¢é‡ |

### 4.2 å¤åˆæ•°æ®ç±»å‹
| ç±»å‹ | å­—é¢é‡ç¤ºä¾‹ | è¯´æ˜ |
|------|-----------|------|
| åˆ—è¡¨ | `[1, 2, 3]` | åˆ—è¡¨å­—é¢é‡ |
| å­—å…¸ | `{"key": "value"}` | å­—å…¸å­—é¢é‡ |

### 4.3 ç±»å‹ç³»ç»Ÿç‰¹å¾
- **åŠ¨æ€ç±»å‹**ï¼šå˜é‡æ— ç±»å‹å£°æ˜
- **è‡ªåŠ¨ç±»å‹æ¨æ–­**ï¼šè¿è¡Œæ—¶ç¡®å®šç±»å‹
- **ç±»å‹è½¬æ¢**ï¼šæŸäº›æ“ä½œè‡ªåŠ¨è½¬æ¢
- **Pythonå¯¹è±¡é›†æˆ**ï¼šPythonå¯¹è±¡ä½œä¸ºä¸€ç­‰å…¬æ°‘

### 4.4 å¸ƒå°”ä¸ç±»å‹è½¬æ¢ï¼ˆçœŸå€¼è§„åˆ™ï¼‰ ğŸ’¡
PyScript çš„è¿è¡Œæ—¶ç±»å‹ `ScriptValue` æä¾›å®½æ¾çš„çœŸå€¼/è½¬æ¢ç­–ç•¥ï¼Œè¡Œä¸ºå¦‚ä¸‹ï¼š

- `toBoolean()` çš„è§„åˆ™ï¼š
  - `Boolean`ï¼šç›´æ¥è¿”å›å¸ƒå°”å€¼ï¼›
  - `Integer`ï¼šé0ä¸ºçœŸï¼›
  - `Double`ï¼šé0.0ä¸ºçœŸï¼›
  - `String`ï¼šéç©ºå­—ç¬¦ä¸²ä¸ºçœŸï¼›
  - `Null`ï¼šä¸ºå‡ï¼›
  - `List`ï¼šéç©ºä¸ºçœŸï¼›
  - `Dictionary`ï¼šéç©ºä¸ºçœŸï¼›
  - `PythonObject`ï¼šå°è¯•ä½¿ç”¨ Python çš„å¸ƒå°”è¯­ä¹‰ï¼ˆ`py::bool_(obj)`ï¼‰ï¼Œè‹¥æ­¤æ“ä½œå¤±è´¥åˆ™é»˜è®¤å¯¹éç©ºå¯¹è±¡è§†ä¸ºçœŸã€‚

- `toInteger()` / `toDouble()` ç­‰â€œsafe-convertâ€å‡½æ•°æŒ‰å¸¸è§è§„åˆ™è¿›è¡Œè½¬æ¢ï¼ˆæµ®ç‚¹æˆªæ–­ã€å­—ç¬¦ä¸²è§£æå¤±è´¥æ—¶è¿”å›0ç­‰ï¼‰ã€‚

æç¤ºï¼šç›´æ¥ä½¿ç”¨ `getBoolean()` / `getInteger()` ç­‰å¸¦æœ‰ç±»å‹æ£€æŸ¥çš„æ–¹æ³•ä¼šåœ¨ç±»å‹ä¸åŒ¹é…æ—¶æŠ›å‡ºå¼‚å¸¸ï¼›å¦‚éœ€æ›´å®½å®¹çš„çœŸå€¼æˆ–æ•°é‡è®¡ç®—ï¼Œè¯·ä½¿ç”¨ `toBoolean()` / `toInteger()`ã€‚
## 5. å˜é‡ä¸èµ‹å€¼

### 5.1 å˜é‡å£°æ˜ä¸èµ‹å€¼
```python
// ç›´æ¥èµ‹å€¼åˆ›å»ºå˜é‡
x = 10;                    // æ•´æ•°
name = "Alice";           // å­—ç¬¦ä¸²
flag = true;              // å¸ƒå°”å€¼
list = [1, 2, 3];         // åˆ—è¡¨
dict = {"a": 1, "b": 2};  // å­—å…¸
```

### 5.2 èµ‹å€¼è¿ç®—ç¬¦
| è¿ç®—ç¬¦ | ç¤ºä¾‹ | æè¿° |
|--------|------|------|
| `=` | `x = 10` | ç®€å•èµ‹å€¼ |
| `+=` | `x += 5` | åŠ æ³•èµ‹å€¼ |
| `-=` | `x -= 3` | å‡æ³•èµ‹å€¼ |
| `*=` | `x *= 2` | ä¹˜æ³•èµ‹å€¼ |
| `/=` | `x /= 4` | é™¤æ³•èµ‹å€¼ |
| `%=` | `x %= 3` | å–æ¨¡èµ‹å€¼ |

### 5.3 å±æ€§èµ‹å€¼å’Œä¸‹æ ‡èµ‹å€¼
PyScriptæ”¯æŒå¯¹è±¡å±æ€§èµ‹å€¼å’Œå®¹å™¨ä¸‹æ ‡èµ‹å€¼ï¼š

```python
// å¯¹è±¡å±æ€§èµ‹å€¼
import complex_test_script as cts;
obj = new cts.ComplexData(2);
obj.new_attr = 42;          // åŠ¨æ€æ·»åŠ å±æ€§
value = obj.new_attr;       // è¯»å–å±æ€§

// å­—å…¸æˆå‘˜èµ‹å€¼ï¼ˆå±æ€§é£æ ¼ï¼‰
d = {"a": 1};
d.b = 2;                    // æ·»åŠ æ–°é”®å€¼å¯¹
value = d.b;                // è¯»å–å€¼

// å­—å…¸ä¸‹æ ‡èµ‹å€¼
my_dict = {"a": 100, "b": 200};
my_dict["c"] = 300;        // ä½¿ç”¨ä¸‹æ ‡æ·»åŠ 
value = my_dict["c"];      // ä½¿ç”¨ä¸‹æ ‡è®¿é—®

// åˆ—è¡¨ä¸‹æ ‡èµ‹å€¼
my_list = [1, 2, 3, 4, 5];
my_list[2] = 999;          // ä¿®æ”¹å…ƒç´ 
value = my_list[2];        // è®¿é—®å…ƒç´ 
```

### 5.4 å¤šé‡èµ‹å€¼
```python
// é“¾å¼èµ‹å€¼
a = b = c = 0;

// Pythoné£æ ¼å¤šé‡èµ‹å€¼
x, y = 10, 20;
```

## 6. è¡¨è¾¾å¼ä¸è¿ç®—ç¬¦

### 6.1 ç®—æœ¯è¿ç®—ç¬¦
| è¿ç®—ç¬¦ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|
| `+` | åŠ æ³• | `x + y` |
| `-` | å‡æ³• | `x - y` |
| `*` | ä¹˜æ³• | `x * y` |
| `/` | é™¤æ³• | `x / y` |
| `%` | å–æ¨¡ | `x % y` |
| `**` | å¹‚è¿ç®— | `x ** y` |
| `-`ï¼ˆä¸€å…ƒï¼‰ | è´Ÿå· | `-x` |

### 6.2 æ¯”è¾ƒè¿ç®—ç¬¦
| è¿ç®—ç¬¦ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|
| `==` | ç­‰äº | `x == y` |
| `!=` | ä¸ç­‰äº | `x != y` |
| `<` | å°äº | `x < y` |
| `<=` | å°äºç­‰äº | `x <= y` |
| `>` | å¤§äº | `x > y` |
| `>=` | å¤§äºç­‰äº | `x >= y` |

### 6.3 é€»è¾‘è¿ç®—ç¬¦
| è¿ç®—ç¬¦ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|
| `&&` | é€»è¾‘ä¸ | `x && y` |
| `||` | é€»è¾‘æˆ– | `x || y` |
| `!` | é€»è¾‘é | `!x` |

### 6.4 ä½è¿ç®—ç¬¦
| è¿ç®—ç¬¦ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|
| `&` | æŒ‰ä½ä¸ | `x & y` |
| `|` | æŒ‰ä½æˆ– | `x | y` |
| `^` | æŒ‰ä½å¼‚æˆ– | `x ^ y` |
| `~` | æŒ‰ä½å–å | `~x` |
| `<<` | å·¦ç§» | `x << n` |
| `>>` | å³ç§» | `x >> n` |

### 6.5 æˆå‘˜è¿ç®—ç¬¦
| è¿ç®—ç¬¦ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|
| `in` | æˆå‘˜æ£€æŸ¥ | `x in list` |

### 6.6 å­—å…¸è§£åŒ…è¿ç®—ç¬¦
PyScriptæ”¯æŒå­—å…¸è§£åŒ…æ“ä½œç¬¦`**`ï¼Œç”¨äºåˆå¹¶å­—å…¸æˆ–å°†å­—å…¸é¡¹å±•å¼€åˆ°å­—é¢é‡å­—å…¸ä¸­ï¼š

```python
// å­—å…¸è§£åŒ…åˆå¹¶
d1 = {"server": "localhost", "port": 8080};
d2 = {"username": "admin", "password": "secret"};
d3 = {"level": "debug", "file": "app.log"};

// åˆå¹¶å¤šä¸ªå­—å…¸ï¼ˆæŒ‰å†™å‡ºé¡ºåºä»å·¦åˆ°å³æ±‚å€¼ï¼‰ï¼Œåé¢å‡ºç°çš„é”®ä¼šè¦†ç›–å‰é¢çš„åŒåé”®
full_config = {**d1, **d2, **d3, "timeout": 30};

// å­—å…¸è§£åŒ…é¡ºåºç¤ºä¾‹
base = {"x": 1};
override = {"x": 2};
result = {**base, **override, "y": 3};  // {"x": 2, "y": 3}
```

è¯´æ˜ï¼šå­—å…¸å­—é¢é‡å†…éƒ¨çš„é¡¹ï¼ˆé”®å€¼å¯¹æˆ–`**`å±•å¼€é¡¹ï¼‰ä¼šæŒ‰å‡ºç°é¡ºåºè¢«è®¡ç®—ä¸åˆå¹¶ï¼›å½“å­˜åœ¨é‡å¤é”®æ—¶ï¼Œä»¥**æœ€åå‡ºç°çš„**é”®ä¸ºå‡†ï¼ˆè¦†ç›–è§„åˆ™ï¼‰ã€‚
### 6.7 è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
1. `()` æ‹¬å·
2. `**` å¹‚è¿ç®—ï¼ˆ**æ³¨æ„ï¼š`**` æ˜¯**å³ç»“åˆ**è¿ç®—ï¼Œè¡¨è¾¾å¼ `2 ** 3 ** 2` è§£æä¸º `2 ** (3 ** 2)`ï¼‰
3. `+`ï¼ˆæ­£å·ï¼‰ `-`ï¼ˆè´Ÿå·ï¼‰ `!`ï¼ˆé€»è¾‘éï¼‰ `~`ï¼ˆæŒ‰ä½éï¼‰
4. `*` `/` `%`
5. `+` `-`
6. `<<` `>>`
7. `<` `<=` `>` `>=`
8. `==` `!=`
9. `&` æŒ‰ä½ä¸
10. `^` æŒ‰ä½å¼‚æˆ–
11. `|` æŒ‰ä½æˆ–
12. `&&` é€»è¾‘ä¸
13. `||` é€»è¾‘æˆ–
14. èµ‹å€¼è¿ç®—ç¬¦

## 7. æ§åˆ¶æµè¯­å¥

### 7.1 æ¡ä»¶è¯­å¥
```python
// ifè¯­å¥
if (x > 0) {
    print("positive");
}

// if-elseè¯­å¥
if (x > 0) {
    print("positive");
} else {
    print("non-positive");
}

// if-elif-elseè¯­å¥
if (x > 0) {
    print("positive");
} elif (x == 0) {
    print("zero");
} else {
    print("negative");
}
```

### 7.2 å¾ªç¯è¯­å¥
```python
// whileå¾ªç¯
i = 0;
while (i < 10) {
    print(i);
    i = i + 1;
}

// forå¾ªç¯ï¼ˆCé£æ ¼ï¼‰
for (i = 0; i < 10; i = i + 1) {
    print(i);
}

// for-inå¾ªç¯ï¼ˆéå†é›†åˆï¼‰
list = [1, 2, 3, 4, 5];
for (item in list) {
    print(item);
}
```

### 7.3 è·³è½¬è¯­å¥
```python
// returnè¯­å¥
def add(x, y) {
    return x + y;
}

// breakå’Œcontinueä¸æ”¯æŒï¼
// ä»¥ä¸‹ä»£ç ä¼šè¯­æ³•é”™è¯¯ï¼š
// for (i = 0; i < 10; i = i + 1) {
//     if (i == 5) {
//         break;  // é”™è¯¯ï¼šä¸æ”¯æŒbreak
//     }
// }
```

## 8. å‡½æ•°å®šä¹‰ä¸è°ƒç”¨

### 8.1 å‡½æ•°å®šä¹‰
```python
// åŸºæœ¬å‡½æ•°å®šä¹‰
def greet(name) {
    print("Hello, " + name + "!");
}

// å¸¦è¿”å›å€¼çš„å‡½æ•°
def square(x) {
    return x * x;
}

// å¤šå‚æ•°å‡½æ•°
def add(x, y) {
    return x + y;
}
```

### 8.2 å‡½æ•°å‚æ•°
```python
// ç®€å•çš„å‚æ•°åˆ—è¡¨
def process(a, b, c) {
    return a + b + c;
}

// å‚æ•°è§£åŒ…è°ƒç”¨ï¼ˆä½¿ç”¨*å’Œ**ï¼‰
def f(a, b) {
    return a + b;
}

arr = [1, 2];
result1 = f(*arr);  // ä½¿ç”¨*è§£åŒ…åˆ—è¡¨/å¯è¿­ä»£å¯¹è±¡

// æ”¯æŒé»˜è®¤å‚æ•°å€¼çš„å®šä¹‰
def g(a=0, b=0) {
    return a * b;
}

d = {"a": 3, "b": 4};
result2 = g(**d);   // ä½¿ç”¨**è§£åŒ…å­—å…¸
```

**å‚æ•°è°ƒç”¨è¯­ä¹‰ (è¯¦è¿°)** ğŸ”§
- æ”¯æŒä½ç½®å‚æ•°ï¼ˆæŒ‰å®šä¹‰é¡ºåºä¼ å…¥ï¼‰ã€‚
- æ”¯æŒå…³é”®å­—å‚æ•°ï¼Œè°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨`name = expr`çš„å½¢å¼ï¼ˆæˆ–ç›´æ¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨èµ‹å€¼è¡¨è¾¾å¼`name = expr`ä½œä¸ºå‚æ•°ï¼‰ã€‚
- æ”¯æŒä½ç½®å‚æ•°å±•å¼€ `*expr`ï¼Œå½“ `expr` æ˜¯åˆ—è¡¨æˆ–ä»»æ„å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œä¼šå°†å…¶å…ƒç´ é€ä¸€å±•å¼€å¹¶è¿½åŠ åˆ°ä½ç½®å‚æ•°æœ«ç«¯ã€‚
- æ”¯æŒå…³é”®å­—å‚æ•°å±•å¼€ `**expr`ï¼Œå½“ `expr` æ˜¯å­—å…¸æˆ–æ˜ å°„æ—¶ï¼Œä¼šæŠŠå…¶ä¸­çš„é”®/å€¼åŠ å…¥åˆ°å…³é”®å­—å‚æ•°é›†åˆä¸­ï¼›å±•å¼€è¿‡ç¨‹ä¸­åå‡ºç°çš„é”®ä¼šè¦†ç›–å…ˆå‰çš„é”®ï¼ˆåè€…è¦†ç›–å‰è€…ï¼‰ã€‚
- å‚æ•°ä¸å±•å¼€é¡¹æŒ‰æºä»£ç ä¸­å‡ºç°çš„é¡ºåºé€ä¸€å¤„ç†ï¼ˆä»å·¦åˆ°å³ï¼‰ã€‚
- å¦‚æœå±•å¼€çš„å¯¹è±¡ç±»å‹ä¸æ­£ç¡®ï¼ˆå¦‚å¯¹`**`ä¼ å…¥éæ˜ å°„ï¼‰ï¼Œè°ƒç”¨æ—¶ä¼šæŠ¥é”™å¹¶ç»ˆæ­¢è°ƒç”¨ã€‚
### 8.3 Lambdaè¡¨è¾¾å¼
```python
// lambdaè¡¨è¾¾å¼è¯­æ³•
square = lambda x: x * x;
result = square(5);  // 25

// lambdaä½œä¸ºå‚æ•°
numbers = [1, 2, 3, 4, 5];
squared = [lambda x: x * x for x in numbers];  // åˆ—è¡¨æ¨å¯¼å¼

// å¤šå‚æ•°lambda
add = lambda x, y: x + y;
sum = add(10, 20);  // 30

// lambdaä¸å­—å…¸æ“ä½œç»“åˆ
double_value = lambda x: {**x, "value": x["value"] * 2};
result = double_value({"name": "test", "value": 5});
```

### 8.4 å‡½æ•°ä½œç”¨åŸŸ
```python
x = 10;  // å…¨å±€å˜é‡

def outer() {
    y = 20;  // outerå±€éƒ¨å˜é‡
    print(x + y);  // å¯ä»¥è®¿é—®å…¨å±€å˜é‡
}

outer();
print(y);  // é”™è¯¯ï¼šyæœªå®šä¹‰ï¼ˆä½œç”¨åŸŸå¤–ï¼‰
```

## 9. Pythoné›†æˆç‰¹æ€§

### 9.1 Pythonæ¨¡å—å¯¼å…¥
```python
// å¯¼å…¥æ•´ä¸ªæ¨¡å—
import os;
import math;

// å¸¦åˆ«åçš„å¯¼å…¥
import datetime as dt;

// ä½¿ç”¨å¯¼å…¥çš„æ¨¡å—
path = os.getcwd();
pi = math.pi;
now = dt.datetime.now();
```

### 9.2 Pythonå‡½æ•°è°ƒç”¨
```python
// è°ƒç”¨Pythonå‡½æ•°
import math;
result = math.sqrt(16);  // 4.0

// è°ƒç”¨å¯¹è±¡æ–¹æ³•
import datetime;
now = datetime.datetime.now();
formatted = now.strftime("%Y-%m-%d");
```

### 9.3 Pythonå¯¹è±¡åˆ›å»º
```python
// ä½¿ç”¨newåˆ›å»ºPythonå¯¹è±¡
import datetime;
date = new datetime.datetime(2025, 12, 23);

// åˆ›å»ºè‡ªå®šä¹‰ç±»å®ä¾‹
import mymodule;
obj = new mymodule.MyClass(arg1, arg2);
```

### 9.4 å±æ€§ä¸ä¸‹æ ‡è®¿é—®
```python
// å±æ€§è®¿é—®
import requests;
resp = requests.get("https://api.example.com");
status = resp.status_code;

// ä¸‹æ ‡è®¿é—®
list = [10, 20, 30];
first = list[0];  // 10

dict = {"name": "Alice", "age": 30};
name = dict["name"];  // "Alice"
```

### 9.5 åˆ—è¡¨æ¨å¯¼å¼
```python
// åŸºæœ¬åˆ—è¡¨æ¨å¯¼å¼
numbers = [1, 2, 3, 4, 5];
squares = [x * x for x in numbers];  // [1, 4, 9, 16, 25]

// å¸¦æ¡ä»¶çš„åˆ—è¡¨æ¨å¯¼å¼
evens = [x for x in numbers if x % 2 == 0];  // [2, 4]
```

## 10. æ¨¡å—ä¸å¯¼å…¥

### 10.1 æ¨¡å—å¯¼å…¥è¯­æ³•
```python
// ç»å¯¹å¯¼å…¥
import module;
import package.module;

// å¸¦åˆ«å
import long_module_name as short;

// ä¸æ”¯æŒfrom...importè¯­æ³•
// from datetime import datetime;  // é”™è¯¯ï¼šä¸æ”¯æŒ
```

### 10.2 æ¨¡å—æœç´¢
- å½“å‰ç›®å½•
- Pythonçš„sys.path
- ç¯å¢ƒå˜é‡PYTHONPATHæŒ‡å®šçš„è·¯å¾„

## 11. å®é™…ä»£ç ç¤ºä¾‹

### 11.1 ç®€å•è®¡ç®—å™¨
```python
def calculate(operation, a, b) {
    if (operation == "add") {
        return a + b;
    } elif (operation == "subtract") {
        return a - b;
    } elif (operation == "multiply") {
        return a * b;
    } elif (operation == "divide") {
        if (b != 0) {
            return a / b;
        } else {
            print("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶");
            return null;
        }
    } else {
        print("é”™è¯¯ï¼šä¸æ”¯æŒçš„æ“ä½œ");
        return null;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
result = calculate("add", 10, 5);  // 15
print("ç»“æœ: " + str(result));
```

### 11.2 æ•°æ®å¤„ç†è„šæœ¬
```python
// å¤„ç†æ•°æ®åˆ—è¡¨
def process_data(data) {
    total = 0;
    count = 0;
    
    for (item in data) {
        total = total + item;
        count = count + 1;
    }
    
    if (count > 0) {
        average = total / count;
        return {"total": total, "count": count, "average": average};
    } else {
        return {"total": 0, "count": 0, "average": 0};
    }
}

// ä½¿ç”¨ç¤ºä¾‹
data = [10, 20, 30, 40, 50];
stats = process_data(data);
print("æ€»å’Œ: " + str(stats.total));
print("æ•°é‡: " + str(stats.count));
print("å¹³å‡: " + str(stats.average));
```

### 11.3 Pythoné›†æˆç¤ºä¾‹
```python
// ä½¿ç”¨Pythonè¿›è¡Œå¤æ‚è®¡ç®—
import math;

def circle_area(radius) {
    return math.pi * radius * radius;
}

def process_with_python() {
    // ä½¿ç”¨Pythonçš„æ•°å­¦å‡½æ•°
    values = [1, 2, 3, 4, 5];
    processed = [];
    
    for (value in values) {
        // è°ƒç”¨å¤šä¸ªPythonå‡½æ•°
        sin_val = math.sin(value);
        cos_val = math.cos(value);
        sqrt_val = math.sqrt(value);
        
        result = sin_val * cos_val + sqrt_val;
        processed.append(result);
    }
    
    return processed;
}

// æ‰§è¡Œ
area = circle_area(5);
print("åœ†é¢ç§¯: " + str(area));

results = process_with_python();
print("å¤„ç†ç»“æœ: " + str(results));
```

## 12. è¯­è¨€é™åˆ¶ä¸ä¸æ”¯æŒçš„ç‰¹æ€§

### 12.1 å®Œå…¨ä¸æ”¯æŒçš„ç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ | æ›¿ä»£æ–¹æ¡ˆ |
|------|------|----------|
| ç±»å®šä¹‰ | æ— classå…³é”®å­— | ä½¿ç”¨Pythonç±»å¹¶å¯¼å…¥ |
| å¼‚å¸¸å¤„ç† | æ— try/catch/finally | é”™è¯¯é€šè¿‡C++ APIå¤„ç† |
| å¾ªç¯æ§åˆ¶ | æ— break/continue | è°ƒæ•´å¾ªç¯æ¡ä»¶æˆ–ä½¿ç”¨ifè¯­å¥ |
| è£…é¥°å™¨ | æ— è£…é¥°å™¨è¯­æ³• | åœ¨Pythonä¸­å®šä¹‰è£…é¥°å‡½æ•° |
| ç”Ÿæˆå™¨ | æ— yieldå…³é”®å­— | ä½¿ç”¨Pythonç”Ÿæˆå™¨å‡½æ•° |
| å¼‚æ­¥ç¼–ç¨‹ | æ— async/await | ä½¿ç”¨Pythonå¼‚æ­¥å‡½æ•° |
| ç±»å‹æ³¨è§£ | æ— ç±»å‹æç¤ºè¯­æ³• | åœ¨Pythonä¸­å®šä¹‰ç±»å‹ |

### 12.2 è¯­æ³•é™åˆ¶
| é™åˆ¶ | è¯´æ˜ |
|------|------|
| å‡½æ•°å‚æ•° | ä¸æ”¯æŒé»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å…³é”®å­—å‚æ•° |
| å¯¼å…¥è¯­æ³• | ä¸æ”¯æŒfrom...importè¯­æ³• |
| å­—ç¬¦ä¸²æ ¼å¼åŒ– | æ— f-stringæˆ–formatæ–¹æ³•ï¼Œéœ€ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ |
| ä½œç”¨åŸŸæ“ä½œ | æ— globalã€nonlocalå…³é”®å­— |
| æ“ä½œç¬¦é‡è½½ | ä¸æ”¯æŒè‡ªå®šä¹‰æ“ä½œç¬¦ |

### 12.3 å®é™…çº¦æŸ
1. **é”™è¯¯å¤„ç†æœ‰é™**ï¼šè¯­æ³•é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯é€šè¿‡C++ APIæŠ¥å‘Š
2. **æ€§èƒ½è€ƒè™‘**ï¼šæ¯æ¬¡Pythonè°ƒç”¨éƒ½æœ‰è·¨è¯­è¨€å¼€é”€
3. **å†…å­˜ç®¡ç†**ï¼šPythonå¯¹è±¡ç”Ÿå‘½å‘¨æœŸéœ€è¦å°å¿ƒå¤„ç†
4. **è°ƒè¯•å›°éš¾**ï¼šç¼ºä¹å®Œæ•´çš„è°ƒè¯•å’Œå †æ ˆè·Ÿè¸ªæ”¯æŒ

### 12.4 ä½¿ç”¨å»ºè®®
1. **ä¿æŒç®€å•**ï¼šPyScripté€‚åˆç®€å•è„šæœ¬ï¼Œå¤æ‚é€»è¾‘åº”åœ¨Pythonä¸­å®ç°
2. **é”™è¯¯é¢„é˜²**ï¼šåœ¨è„šæœ¬ä¸­é¿å…å¯èƒ½å‡ºé”™çš„æ“ä½œï¼Œé”™è¯¯æ£€æŸ¥é€šè¿‡C++è¿›è¡Œ
3. **æ€§èƒ½æ•æ„Ÿéƒ¨åˆ†ç”¨C++**ï¼šé¢‘ç¹è°ƒç”¨çš„ä»£ç åº”åœ¨C++ä¸­å®ç°
4. **åˆ©ç”¨Pythonç”Ÿæ€**ï¼šå¤æ‚åŠŸèƒ½é€šè¿‡å¯¼å…¥Pythonæ¨¡å—å®ç°

## 13. APIå‚è€ƒ

### 13.1 ScriptInterpreterç±»

#### æ„é€ å‡½æ•°
```cpp
// åˆ›å»ºè§£é‡Šå™¨å®ä¾‹
ScriptInterpreter interpreter;
```

#### ä¸»è¦æ–¹æ³•
```cpp
// æ‰§è¡Œè„šæœ¬å­—ç¬¦ä¸²
bool execute(const std::string& script);

// æ‰§è¡Œè„šæœ¬æ–‡ä»¶
bool executeFile(const std::string& filename);

// è·å–å˜é‡å€¼
std::optional<ScriptValue> getVariable(const std::string& name);

// è®¾ç½®å˜é‡å€¼
void setVariable(const std::string& name, const ScriptValue& value);

// æ¸…ç©ºç¯å¢ƒ
void clearEnvironment();

// è·å–æ‰§è¡Œç»“æœ
std::optional<ScriptValue> getResult();

// æ£€æŸ¥é”™è¯¯
bool hasError() const;
std::string getErrorMessage() const;
```

### 13.2 é”™è¯¯å¤„ç†

#### é”™è¯¯ç±»å‹
```cpp
enum class ScriptErrorType {
    Syntax,     // è¯­æ³•é”™è¯¯
    Runtime,    // è¿è¡Œæ—¶é”™è¯¯
    Type,       // ç±»å‹é”™è¯¯
    Python,     // Pythonç›¸å…³é”™è¯¯
    Unknown     // æœªçŸ¥é”™è¯¯
};
```

#### é”™è¯¯ä¿¡æ¯
```cpp
// è·å–è¯¦ç»†é”™è¯¯
std::vector<ScriptError> getAllErrors();
std::optional<ScriptError> getLastError();
```

### 13.3 é…ç½®é€‰é¡¹

#### Pythonè·¯å¾„é…ç½®
```cpp
// åœ¨æ‰§è¡Œå‰é…ç½®Pythonè·¯å¾„
py::module_ sys = py::module_::import("sys");
sys.attr("path").attr("insert")(0, "/path/to/modules");
```

#### æ—¥å¿—é…ç½®
```cpp
// è®¾ç½®æ—¥å¿—çº§åˆ«
interpreter.setLogLevel(LogLevel::INFO);
interpreter.setLogLevel(LogLevel::DEBUG);
interpreter.setLogLevel(LogLevel::WARNING);
interpreter.setLogLevel(LogLevel::ERROR);

// è®¾ç½®æ—¥å¿—è¾“å‡º
interpreter.setLogOutput(std::cout);
```

---

## é™„å½•

### A. ä¿ç•™å…³é”®å­—åˆ—è¡¨
| å…³é”®å­— | ç”¨é€” |
|--------|------|
| `def` | å‡½æ•°å®šä¹‰ |
| `if` | æ¡ä»¶è¯­å¥ |
| `else` | æ¡ä»¶è¯­å¥ |
| `elif` | æ¡ä»¶è¯­å¥ |
| `while` | å¾ªç¯è¯­å¥ |
| `for` | å¾ªç¯è¯­å¥ |
| `import` | æ¨¡å—å¯¼å…¥ |
| `as` | å¯¼å…¥åˆ«å |
| `new` | åˆ›å»ºPythonå¯¹è±¡ |
| `lambda` | Lambdaè¡¨è¾¾å¼ |
| `in` | æˆå‘˜è¿ç®—ç¬¦ |
| `return` | å‡½æ•°è¿”å› |

**æ³¨æ„**ï¼š
- `true`ã€`false`ã€`null`æ˜¯å­—é¢é‡ï¼Œä¸æ˜¯å…³é”®å­—
- `class`ã€`try`ã€`catch`ã€`finally`ã€`break`ã€`continue`ã€`throw`ã€`static`ã€`super`ã€`this`ç­‰ä¸æ˜¯PyScriptå…³é”®å­—

### B. å­—é¢é‡åˆ—è¡¨
| å­—é¢é‡ | ç±»å‹ | ç¤ºä¾‹ |
|--------|------|------|
| æ•´æ•° | æ•´å‹ | `42`, `-10`, `0` |
| æµ®ç‚¹æ•° | æµ®ç‚¹å‹ | `3.14`, `-2.5`, `.5` |
| å­—ç¬¦ä¸² | å­—ç¬¦ä¸² | `"hello"`, `'world'` |
| å¸ƒå°”å€¼ | å¸ƒå°”å‹ | `true`, `false` |
| ç©ºå€¼ | ç©ºç±»å‹ | `null` |
| åˆ—è¡¨ | åˆ—è¡¨ | `[1, 2, 3]` |
| å­—å…¸ | å­—å…¸ | `{"key": "value"}` |

### C. è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨ï¼ˆç®€ç‰ˆï¼‰
1. `()` æ‹¬å·
2. `**` å¹‚è¿ç®—
3. `!` `~` `+`ï¼ˆæ­£ï¼‰ `-`ï¼ˆè´Ÿï¼‰
4. `*` `/` `%`
5. `+` `-`
6. `<<` `>>`
7. `<` `<=` `>` `>=`
8. `==` `!=`
9. `&`
10. `^`
11. `|`
12. `&&`
13. `||`
14. èµ‹å€¼è¿ç®—ç¬¦

### D. å¸¸è§é”™è¯¯ä»£ç 
| é”™è¯¯ä»£ç  | æè¿° | å¯èƒ½åŸå›  |
|----------|------|----------|
| 1001 | è¯­æ³•é”™è¯¯ | è„šæœ¬è¯­æ³•ä¸æ­£ç¡® |
| 1002 | å˜é‡æœªå®šä¹‰ | ä½¿ç”¨æœªå£°æ˜çš„å˜é‡ |
| 1003 | ç±»å‹ä¸åŒ¹é… | æ“ä½œç¬¦åº”ç”¨äºä¸å…¼å®¹çš„ç±»å‹ |
| 1004 | Pythonå¼‚å¸¸ | è°ƒç”¨çš„Pythonå‡½æ•°æŠ›å‡ºå¼‚å¸¸ |
| 1005 | æ–‡ä»¶æœªæ‰¾åˆ° | å¼•ç”¨çš„æ–‡ä»¶ä¸å­˜åœ¨ |
| 1006 | å¯¼å…¥é”™è¯¯ | æ— æ³•å¯¼å…¥æŒ‡å®šçš„æ¨¡å— |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 (å‡†ç¡®ç‰ˆ)  
**æœ€åæ›´æ–°**: 2025å¹´12æœˆ23æ—¥  
**ä½œè€…**: Cline (AI Assistant)  
**é€‚ç”¨é¡¹ç›®**: pybind11callpython  

**å…³é”®æ›´æ–°**:
- åŸºäºå®é™…ANTLRè¯­æ³•æ–‡ä»¶(`antlr/PyScript.g4`)é‡å†™
- å‡†ç¡®åæ˜ æ”¯æŒå’Œä¸æ”¯æŒçš„è¯­è¨€ç‰¹æ€§
- ç§»é™¤æ‰€æœ‰è‡†æµ‹å’Œå‡è®¾å†…å®¹
- æä¾›å®é™…çš„ä»£ç ç¤ºä¾‹å’Œä½¿ç”¨é™åˆ¶

**éªŒè¯ä¾æ®**:
- `antlr/PyScript.g4` è¯­æ³•å®šä¹‰æ–‡ä»¶
- æµ‹è¯•æ–‡ä»¶(`test_*.cpp`)ä¸­çš„ç¤ºä¾‹
- æºä»£ç ä¸­çš„å®é™…å®ç°

**æ³¨æ„**: æœ¬è§„èŒƒå®Œå…¨åŸºäºé¡¹ç›®å®é™…ä»£ç åˆ†æï¼Œç¡®ä¿å‡†ç¡®æ€§å’Œå®ç”¨æ€§ã€‚
